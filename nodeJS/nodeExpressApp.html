<!DOCTYPE html>
<html lang="zh-tw">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/images/favicon.ico"><title>NodeJS架設Web服務 | 網頁開發筆記</title><meta name="description" content="">
    <link rel="modulepreload" href="/assets/app.f5b9a5c3.js"><link rel="modulepreload" href="/assets/nodeExpressApp.html.8a768cec.js"><link rel="modulepreload" href="/assets/nodeExpressApp.html.f33f0258.js"><link rel="prefetch" href="/assets/index.html.64afda47.js"><link rel="prefetch" href="/assets/buildByVite.html.088cc128.js"><link rel="prefetch" href="/assets/buildPackage.html.c8c96688.js"><link rel="prefetch" href="/assets/designRules.html.99eade0a.js"><link rel="prefetch" href="/assets/genDoc.html.c6d7277c.js"><link rel="prefetch" href="/assets/Vitest.html.34c0d42e.js"><link rel="prefetch" href="/assets/crawler.html.36a9bdce.js"><link rel="prefetch" href="/assets/colorMode.html.11446be8.js"><link rel="prefetch" href="/assets/nuxtApp.html.4ddd2f3c.js"><link rel="prefetch" href="/assets/nuxtFeat.html.8c22d6e6.js"><link rel="prefetch" href="/assets/d3WithGantte.html.396d476d.js"><link rel="prefetch" href="/assets/firebaseApp.html.f815f165.js"><link rel="prefetch" href="/assets/heroku.html.101f2bda.js"><link rel="prefetch" href="/assets/learnDockerfile.html.b0fb0411.js"><link rel="prefetch" href="/assets/lineBot.html.a896e0ab.js"><link rel="prefetch" href="/assets/screenShot.html.35d04623.js"><link rel="prefetch" href="/assets/websocketAndSocketIO.html.7798e422.js"><link rel="prefetch" href="/assets/accountApp.html.3c0dff3d.js"><link rel="prefetch" href="/assets/card.html.0f7edb4e.js"><link rel="prefetch" href="/assets/quasarApp.html.8b1b944b.js"><link rel="prefetch" href="/assets/vue2AndVue-cli.html.feb020d4.js"><link rel="prefetch" href="/assets/vue3AndVite.html.104c101d.js"><link rel="prefetch" href="/assets/404.html.93732beb.js"><link rel="prefetch" href="/assets/index.html.795d45ab.js"><link rel="prefetch" href="/assets/buildByVite.html.7ba6abeb.js"><link rel="prefetch" href="/assets/buildPackage.html.27ddddce.js"><link rel="prefetch" href="/assets/designRules.html.8d0f5c22.js"><link rel="prefetch" href="/assets/genDoc.html.b4a15fb8.js"><link rel="prefetch" href="/assets/Vitest.html.765532d9.js"><link rel="prefetch" href="/assets/crawler.html.cb006c69.js"><link rel="prefetch" href="/assets/colorMode.html.27158bc5.js"><link rel="prefetch" href="/assets/nuxtApp.html.c623772b.js"><link rel="prefetch" href="/assets/nuxtFeat.html.d3c65e7e.js"><link rel="prefetch" href="/assets/d3WithGantte.html.104a16d1.js"><link rel="prefetch" href="/assets/firebaseApp.html.7809d93c.js"><link rel="prefetch" href="/assets/heroku.html.03638eba.js"><link rel="prefetch" href="/assets/learnDockerfile.html.9b4940ac.js"><link rel="prefetch" href="/assets/lineBot.html.cf2e7cc5.js"><link rel="prefetch" href="/assets/screenShot.html.e86a1cd7.js"><link rel="prefetch" href="/assets/websocketAndSocketIO.html.fb51259f.js"><link rel="prefetch" href="/assets/accountApp.html.75da39e6.js"><link rel="prefetch" href="/assets/card.html.b77271ab.js"><link rel="prefetch" href="/assets/quasarApp.html.39200212.js"><link rel="prefetch" href="/assets/vue2AndVue-cli.html.ac1bbec5.js"><link rel="prefetch" href="/assets/vue3AndVite.html.18d971f1.js"><link rel="prefetch" href="/assets/404.html.1e5d31cd.js">
    <link rel="stylesheet" href="/assets/style.f4d22aab.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">網頁開發筆記</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/" class="sidebar-item sidebar-heading" aria-label="首頁"><!--[--><!--]--> 首頁 <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">nodeJS <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/nodeJS/crawler.md" class="sidebar-item" aria-label="資料爬取與儲存"><!--[--><!--]--> 資料爬取與儲存 <!--[--><!--]--></a><!----></li><li><a href="/nodeJS/nodeExpressApp.md" class="sidebar-item active" aria-label="NodeJS架設Web服務"><!--[--><!--]--> NodeJS架設Web服務 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">build-UI <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/build-UI/designRules.md" class="sidebar-item" aria-label="前端UI設計規範引入"><!--[--><!--]--> 前端UI設計規範引入 <!--[--><!--]--></a><!----></li><li><a href="/build-UI/genDoc.md" class="sidebar-item" aria-label="自動生成demo文件"><!--[--><!--]--> 自動生成demo文件 <!--[--><!--]--></a><!----></li><li><a href="/build-UI/buildPackage.md" class="sidebar-item" aria-label="Vite打包 "><!--[--><!--]--> Vite打包  <!--[--><!--]--></a><!----></li><li><a href="/build-UI/buildByVite.md" class="sidebar-item" aria-label="vite打包優化"><!--[--><!--]--> vite打包優化 <!--[--><!--]--></a><!----></li><li><a href="/build-UI/Vitest.md" class="sidebar-item" aria-label="元件測試"><!--[--><!--]--> 元件測試 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">nuxtJS <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/nuxtJS/nuxtApp.md" class="sidebar-item" aria-label="Nuxt3 App建置"><!--[--><!--]--> Nuxt3 App建置 <!--[--><!--]--></a><!----></li><li><a href="/nuxtJS/nuxtFeat.md" class="sidebar-item" aria-label="Nuxt3 功能"><!--[--><!--]--> Nuxt3 功能 <!--[--><!--]--></a><!----></li><li><a href="/nuxtJS/colorMode.md" class="sidebar-item" aria-label="切換顏色模式"><!--[--><!--]--> 切換顏色模式 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">third-part <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/third-part/d3WithGantte.md" class="sidebar-item" aria-label="D3畫甘特圖"><!--[--><!--]--> D3畫甘特圖 <!--[--><!--]--></a><!----></li><li><a href="/third-part/firebaseApp.md" class="sidebar-item" aria-label="firebase App"><!--[--><!--]--> firebase App <!--[--><!--]--></a><!----></li><li><a href="/third-part/heroku.md" class="sidebar-item" aria-label="heroku 使用"><!--[--><!--]--> heroku 使用 <!--[--><!--]--></a><!----></li><li><a href="/third-part/learnDockerfile.md" class="sidebar-item" aria-label="docker 學習"><!--[--><!--]--> docker 學習 <!--[--><!--]--></a><!----></li><li><a href="/third-part/lineBot.md" class="sidebar-item" aria-label="LineBot API串接"><!--[--><!--]--> LineBot API串接 <!--[--><!--]--></a><!----></li><li><a href="/third-part/screenShot.md" class="sidebar-item" aria-label="畫面截圖"><!--[--><!--]--> 畫面截圖 <!--[--><!--]--></a><!----></li><li><a href="/third-part/websocketAndSocketIO.md" class="sidebar-item" aria-label="websocket 和 socketIO"><!--[--><!--]--> websocket 和 socketIO <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">vue-pratice <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/vue-pratice/vue3AndVite.md.md" class="sidebar-item" aria-label="vue3 And Vite"><!--[--><!--]--> vue3 And Vite <!--[--><!--]--></a><!----></li><li><a href="/vue-pratice/vue2AndVue-cli.md" class="sidebar-item" aria-label="vue2 And Vue-cli"><!--[--><!--]--> vue2 And Vue-cli <!--[--><!--]--></a><!----></li><li><a href="/vue-pratice/card.md" class="sidebar-item" aria-label="vue3 slot"><!--[--><!--]--> vue3 slot <!--[--><!--]--></a><!----></li><li><a href="/vue-pratice/accountApp.md" class="sidebar-item" aria-label="vue3 &amp; Firebase App"><!--[--><!--]--> vue3 &amp; Firebase App <!--[--><!--]--></a><!----></li><li><a href="/vue-pratice/quasarApp.md" class="sidebar-item" aria-label="Quasar App"><!--[--><!--]--> Quasar App <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="nodejs架設web服務" tabindex="-1"><a class="header-anchor" href="#nodejs架設web服務" aria-hidden="true">#</a> NodeJS架設Web服務</h1><p>NodeJS生態倚賴許多NPM中的套件庫，可以用來協助架設各種Web服務，以下是架設過程的紀錄。</p><p><a href="https://github.com/lian0103/NodeAPI" target="_blank" rel="noopener noreferrer">Github<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="目錄結構" tabindex="-1"><a class="header-anchor" href="#目錄結構" aria-hidden="true">#</a> 目錄結構</h2><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>│  .env
│  .env.example
│  .gitignore
│  package-lock.json
│  package.json
│  server.js
│  sql.sql
│  
├─config
│      db.js
│      
├─controllers
│      fileController.js
│      postControllers.js
│      
├─helpers
│      httpLogger.js
│      logger.js
│      mail.js
│      
├─logs
│      error.log
│      info.log
│      
├─models
│      Post.js
│      
├─node_modules
│      
├─routes
│      fileRoutes.js
│      postRoutes.js
│      
├─uploadFiles
│      ccc.jpg
│      
└─views
        uploadFile.ejs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="串接mysql" tabindex="-1"><a class="header-anchor" href="#串接mysql" aria-hidden="true">#</a> 串接MySQL</h2><p>本地安裝MySQL。在安裝成功後，可以先使用workbench做連線測試，這組資訊記錄下來之後要讓Node做連線使用。</p><ul><li><p>連線測試 <img src="https://i.imgur.com/lC9qWYd.jpg" alt=""><img src="https://i.imgur.com/XB5c2Bt.jpg" alt=""></p></li><li><p>建立Post表的欄位與資料</p></li></ul><p><img src="https://i.imgur.com/OrOogrN.jpg" alt=""></p><ul><li>config/db.js</li></ul><p><a href="https://www.npmjs.com/package/mysql2" target="_blank" rel="noopener noreferrer">NPM mysql2<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>()=&gt;{

require(&quot;dotenv&quot;).config(); //藉此讀取.env的參數
const mysql = require(&#39;mysql2&#39;); //連線資料庫所使用的套件

const pool = mysql.createPool({
  host: p<wbr>rocess.env.DB_HOST,
  user: p<wbr>rocess.env.DB_USER,
  database: p<wbr>rocess.env.DB_NAME,
  password: p<wbr>rocess.env.DB_PASSWORD,
  port: p<wbr>rocess.env.DB_PORT
});
}

module.exports = pool.promise();//支持非同步處理的連線池物件

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>.env檔</li></ul><div class="language-shell= ext-shell= line-numbers-mode"><pre class="language-shell="><code># DATABASE CONNECTION ENVIRONMENT VARIABLES
DB_HOST=localhost
DB_USER=root
DB_NAME=blog-app
DB_PASSWORD=root
DB_PORT=3306
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>models/Post.js 建立一個資料類的Model，並實作資料操作的方法，如CRUD。這同時是透過mysql2的API，來執行sql指令。</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>const db = require(&#39;../config/db&#39;);
class Post {
  constructor(title, body) {
    this.title = title;
    this.body = body;
  }

  save() {
    let date = new Date();
    let created_at = `${date.getFullYear()}-${
      date.getMonth() + 1
    }-${date.getDate()}`;
    
    //新增1筆3個欄位的資料
    let sql = `
            INSERT INTO posts(
                title,
                body,
                created_at
            )
            VALUES(
                &#39;${this.title}&#39;,
                &#39;${this.body}&#39;,
                &#39;${created_at}&#39;
            )
        
        `;
    return db.execute(sql);//會回傳1個Promise物件
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="開api" tabindex="-1"><a class="header-anchor" href="#開api" aria-hidden="true">#</a> 開API</h2><p>透過NodeJs Express所啟動的Web服務，連線的網域於 http://localhost:3000 並可監聽來訪請求的路徑與HTTP連線方法(GET、POST、UPDATE、DELTE..)對應。</p><ul><li>server.js</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>//...(略)
app.use(&#39;/posts&#39;, require(&#39;./routes/postRoutes&#39;));

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>routes/postRoutes.js</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>const express = require(&#39;express&#39;);
const postControllers = require(&#39;../controllers/postControllers&#39;)
const router = express.Router();

router.route(&quot;/&quot;).get(postControllers.getAllPosts);

router.route(&quot;/&quot;).post(postControllers.createNewPost);

router.route(&quot;/:id&quot;).get(postControllers.getPostById);

module.exports = router;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Postman測試連線 GET方法與路徑/posts，則可對應去呼叫控制層的資料操作方法，並透過exprss路由的回傳物件將資料回傳。</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>//postControllers.js
const Post = require(&#39;../models/Post&#39;);

exports.getAllPosts = async (req, res, next) =&gt; {
  try {
    const [posts] = await Post.findAll();

    res.status(200).json({ posts });
  } catch (error) {
    console.log(error);
    next(error);
  }
};
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>GET /posts</p><p><img src="https://i.imgur.com/cjUhayn.jpg" alt=""></p><h2 id="上傳檔案" tabindex="-1"><a class="header-anchor" href="#上傳檔案" aria-hidden="true">#</a> 上傳檔案</h2><ul><li>使用套件 <a href="https://www.npmjs.com/package/formidable" target="_blank" rel="noopener noreferrer">formidable<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><a href="https://www.npmjs.com/package/mv" target="_blank" rel="noopener noreferrer">mv<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p>使用表單物件和POST方法傳送檔案，formidable可做為中間層把檔案的資訊做解析。解析後的結果，再利用mv做搬運。</p><ul><li>fileController.js</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>const formidable = require(&#39;formidable&#39;);
const mv = require(&#39;mv&#39;);
const path = require(&#39;path&#39;);
const fs = require(&#39;fs&#39;);

exports.uploadFile = async (req, res, next) =&gt; {
  const form = new formidable.IncomingForm();
  form.parse(req, function (err, fields, files) {
    const uploadPath = path.join(process.cwd(), &#39;uploadFiles&#39;);//自訂的檔案存放路徑

    if (!fs.existsSync(uploadPath)) {
      fs.mkdirSync(&#39;uploadFiles&#39;);
    }

    const filename = fields.fileName
      ? `${fields.fileName}.${
          files.filetoupload.originalFilename.split(&#39;.&#39;)[1]
        }`
      : files.filetoupload.originalFilename;//有輸入自訂檔名欄位時使用自訂檔名
    const oldpath = files.filetoupload.filepath;
    const newpath = path.join(uploadPath, filename);
    
    //這個部分之後再比較把圖片檔File轉base64做法的差異
    mv(oldpath, newpath, function (err) {
      if (err) {
        throw err;
        next();
      }
      res.write(`File uploaded and moved to ${newpath}`);
      res.end();
    });
  });
};


</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="取得檔案" tabindex="-1"><a class="header-anchor" href="#取得檔案" aria-hidden="true">#</a> 取得檔案</h2><p><a href="http://expressjs.com/zh-tw/api.html#res.sendFile" target="_blank" rel="noopener noreferrer">Express SendFile API<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><ul><li>fileController.js</li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>
exports.getFile = async (req, res, next) =&gt; {
  const fileName = req.params.fileName;
  const options = {
    root: path.join(process.cwd(), &#39;uploadFiles&#39;),
  };

  res.sendFile(fileName, options, function (err) {
    if (err) {
      next(new Error(&#39;無此檔案&#39;));
    }
  });
};

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>取得結果</li></ul><p>GET /file/:fileName</p><p><img src="https://i.imgur.com/0eSrCho.jpg" alt=""></p><h2 id="寄送郵件" tabindex="-1"><a class="header-anchor" href="#寄送郵件" aria-hidden="true">#</a> 寄送郵件</h2><ul><li>helpers/mail.js</li></ul><p>支持SMTP、Gmail發送的套件 <a href="https://www.npmjs.com/package/nodemailer" target="_blank" rel="noopener noreferrer">nodemailer<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>const logger = require(&#39;./logger&#39;);
const nodemailer = require(&#39;nodemailer&#39;);

//透過GMAIL帳號和&#39;應用程式密碼&#39;登入
const transporter = nodemailer.createTransport({
  service: &#39;gmail&#39;,
  auth: {
    user: p<wbr>rocess.env.GMAIL_USER,
    pass: p<wbr>rocess.env.GMAIL_PASS,
  },
});

const mailOptions = {
  from: p<wbr>rocess.env.GMAIL_USER,
  to: &#39;kel0oo0@yahoo.com.tw&#39;,
  subject: &#39;Sending Email using Node.js&#39;,
  text: &#39;That was easy???&#39;,
  html: `&lt;h1&gt;HI~~!!&lt;/h1&gt;&lt;img src=&quot;https://miro.medium.com/max/676/1*XEgA1TTwXa5AvAdw40GFow.png&quot;&gt;`,
};

const sendEmail = (options = {}) =&gt; {
  let mergeOption = {
    ...mailOptions,
    ...options,
  };
  
  //發送
  transporter.sendMail(mergeOption, function (error, info) {
    if (error) {
      console.log(error);
    } else {
      logger.info(mergeOption);
    }
  });
};
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>應用程式密碼 <img src="https://i.imgur.com/SzAGCvv.jpg" alt=""></li></ul><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>從nodemailer文件上可知，Gmail的送信方式比較適合開發時測試，真正產品應用時還要考量其他因素，不建議使用Gmail。</p></div><h2 id="api請求紀錄" tabindex="-1"><a class="header-anchor" href="#api請求紀錄" aria-hidden="true">#</a> API請求紀錄</h2><p>使用套件 <a href="https://www.npmjs.com/package/winston" target="_blank" rel="noopener noreferrer">winston<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>:用來產生log檔案 <a href="https://www.npmjs.com/package/morgan" target="_blank" rel="noopener noreferrer">morgan<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>:產生能擷取HTTP資訊的中間層</p><ul><li><p>helplers/logger.js</p></li><li><p>helplers/httpLogger.js</p></li><li><p>紀錄 <img src="https://i.imgur.com/dzh1mVF.jpg" alt=""></p></li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.f5b9a5c3.js" defer></script>
  </body>
</html>
