import{_ as c,r as o,o as l,c as i,a as n,b as a,w as e,d as s,f as u}from"./app-ZJpQfeUV.js";const r={},k=n("h1",{id:"web畫面截圖功能實作",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#web畫面截圖功能實作","aria-hidden":"true"},"#"),s(" web畫面截圖功能實作")],-1),d={class:"table-of-contents"},v=u(`<p>把渲染在web畫面上指定的Dom，轉成一張圖片後下載。在實作上需要使用Html5 Canvas物件(理解成畫布)來繪製指定的Dom，再把Canvas物件轉換成Blob，再轉換成可供瀏覽器觸發下載的ObjectURL格式，並執行觸發下載動作。</p><img src="https://i.imgur.com/kp0HP5v.png" width="300"><h2 id="html2canvas" tabindex="-1"><a class="header-anchor" href="#html2canvas" aria-hidden="true">#</a> html2canvas</h2><p>把web畫面上指定的Dom，轉成一個Canvas物件。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// in vue3 .vue</span>
<span class="token keyword">import</span> html2canvas <span class="token keyword">from</span> <span class="token string">&quot;html2canvas&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//...(略)</span>
<span class="token function">html2canvas</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>refs<span class="token punctuation">.</span>targetDom<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="filesaver" tabindex="-1"><a class="header-anchor" href="#filesaver" aria-hidden="true">#</a> FileSaver</h2><p>把Canvas物件轉成Blob格式，並呼叫FileSaver的API saveAs。而在SaveAs的實作中，則是把Blob格式轉換成可下載的ObjectURL格式。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> saveAs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;file-saver&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//...(略)</span>
canvas<span class="token punctuation">.</span><span class="token function">toBlob</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">blob</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">saveAs</span><span class="token punctuation">(</span>
      blob<span class="token punctuation">,</span>
      <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">imageName.png</span><span class="token template-punctuation string">\`</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//lib FileSaver.js saveAs</span>
<span class="token keyword">function</span> <span class="token function">saveAs</span><span class="token punctuation">(</span><span class="token parameter">blob<span class="token punctuation">,</span> name<span class="token punctuation">,</span> opts</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> <span class="token constant">URL</span> <span class="token operator">=</span> _global<span class="token punctuation">.</span><span class="token constant">URL</span> <span class="token operator">||</span> _global<span class="token punctuation">.</span>webkitURL<span class="token punctuation">;</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  name <span class="token operator">=</span> name <span class="token operator">||</span> blob<span class="token punctuation">.</span>name <span class="token operator">||</span> <span class="token string">&quot;download&quot;</span><span class="token punctuation">;</span>

  a<span class="token punctuation">.</span>download <span class="token operator">=</span> name<span class="token punctuation">;</span>
  a<span class="token punctuation">.</span>rel <span class="token operator">=</span> <span class="token string">&quot;noopener&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> blob <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// 略</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">4e4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 40s</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">click</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="代碼" tabindex="-1"><a class="header-anchor" href="#代碼" aria-hidden="true">#</a> 代碼</h2><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>
<span class="token comment">//實作時有先將畫面一些不需要截圖的部分先隱藏 再擷取重新選染後的Dom</span>
<span class="token keyword">const</span> isCapturing <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">generatorImage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  isCapturing<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> 

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">html2canvas</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>refs<span class="token punctuation">.</span>row2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      isCapturing<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      canvas<span class="token punctuation">.</span><span class="token function">toBlob</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">blob</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">saveAs</span><span class="token punctuation">(</span>
          blob<span class="token punctuation">,</span>
          <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>curDepInfoDateStr<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>curDepInfo<span class="token punctuation">.</span>value<span class="token punctuation">.</span>depName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.png</span><span class="token template-punctuation string">\`</span></span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="blob" tabindex="-1"><a class="header-anchor" href="#blob" aria-hidden="true">#</a> Blob</h2><p>二進位大型物件（英語：binary large object ，或英語：basic large object，縮寫為Blob、BLOB、BLOb），在資料庫管理系統中，將二進位資料儲存為一個單一個體的集合。Blob通常是影像、聲音或多媒體檔案。</p><h2 id="物件資料轉換關係圖" tabindex="-1"><a class="header-anchor" href="#物件資料轉換關係圖" aria-hidden="true">#</a> 物件資料轉換關係圖</h2><p>Image、DataURL、ObjectURL、Blob、Canvas、ImageData、ArrayBuffer、ImageURL。</p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/112c6956ee734162bccebae8547ec061~tplv-k3u1fbpfcp-zoom-1.image"><hr><h2 id="連結" tabindex="-1"><a class="header-anchor" href="#連結" aria-hidden="true">#</a> 連結</h2>`,18),m={href:"https://www.npmjs.com/package/html2canvas",target:"_blank",rel:"noopener noreferrer"},b={href:"https://github.com/eligrey/FileSaver.js",target:"_blank",rel:"noopener noreferrer"},h={href:"https://www.gushiciku.cn/pl/gmpt/zh-tw",target:"_blank",rel:"noopener noreferrer"};function f(g,_){const t=o("router-link"),p=o("ExternalLinkIcon");return l(),i("div",null,[k,n("nav",d,[n("ul",null,[n("li",null,[a(t,{to:"#html2canvas"},{default:e(()=>[s("html2canvas")]),_:1})]),n("li",null,[a(t,{to:"#filesaver"},{default:e(()=>[s("FileSaver")]),_:1})]),n("li",null,[a(t,{to:"#代碼"},{default:e(()=>[s("代碼")]),_:1})]),n("li",null,[a(t,{to:"#blob"},{default:e(()=>[s("Blob")]),_:1})]),n("li",null,[a(t,{to:"#物件資料轉換關係圖"},{default:e(()=>[s("物件資料轉換關係圖")]),_:1})]),n("li",null,[a(t,{to:"#連結"},{default:e(()=>[s("連結")]),_:1})])])]),v,n("ol",null,[n("li",null,[n("a",m,[s("html2canvas官方doc"),a(p)])]),n("li",null,[n("a",b,[s("FileSaver官方doc"),a(p)])]),n("li",null,[n("a",h,[s("聊一聊 15.5K 的 FileSaver，是如何工作的"),a(p)])])])])}const j=c(r,[["render",f],["__file","screenShot.html.vue"]]);export{j as default};
