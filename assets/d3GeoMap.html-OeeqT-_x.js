import{_ as c,r as e,o as i,c as l,a as n,b as a,w as p,d as s,f as u}from"./app-ZJpQfeUV.js";const r={},k=n("h1",{id:"d3js繪製台灣行政區地圖",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#d3js繪製台灣行政區地圖","aria-hidden":"true"},"#"),s(" D3js繪製台灣行政區地圖")],-1),d={class:"table-of-contents"},v=n("p",null,"2022年，大致上的學習範例都是以vue3搭配vite的基礎下實作。D3js官網的範例，就因此需要適度的調整寫法，本篇參照D3js美國地圖zoom效果範例，來實作台灣行政區的地圖zoom效果。",-1),h=n("h2",{id:"topo-json",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#topo-json","aria-hidden":"true"},"#"),s(" topo.json")],-1),m={href:"https://mapshaper.org/",target:"_blank",rel:"noopener noreferrer"},g=u(`<h2 id="d3-topojson-client" tabindex="-1"><a class="header-anchor" href="#d3-topojson-client" aria-hidden="true">#</a> d3 &amp; topojson-client</h2><p>在範例中，需要使用d3和topojson-client套件，需要先使用npm安裝</p><div class="language-shell! line-numbers-mode" data-ext="shell!"><pre class="language-shell!"><code>npm i d3@6.7.0 topojson-client@3.1.0
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ℹ️ 透過topojson-client可以把topo格式的json檔案內容，演算成d3能渲染的路徑數據。</p><p>⚠️ d3版本號差異會影響語法，一些網路上的範例是採用較舊版的版號，需要留意。</p><h2 id="實作重點" tabindex="-1"><a class="header-anchor" href="#實作重點" aria-hidden="true">#</a> 實作重點</h2><h3 id="svg建立" tabindex="-1"><a class="header-anchor" href="#svg建立" aria-hidden="true">#</a> svg建立</h3><p>這裡因為有包成元件，寬高是來自父層，所以有加prop。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// svg#theSVG 是在template中存在 透過d3選取後加上寬高等屬性</span>
d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&#39;#theSVG&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#39;viewBox&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span>width<span class="token punctuation">,</span> props<span class="token punctuation">.</span>height<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#39;width&#39;</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span>width<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#39;height&#39;</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="新增-g-層" tabindex="-1"><a class="header-anchor" href="#新增-g-層" aria-hidden="true">#</a> 新增&#39;g&#39;層</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 這個g層要專門拿來繪製地圖使用</span>
<span class="token keyword">const</span> mapGraph <span class="token operator">=</span> svg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&#39;g&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="建立地理投影" tabindex="-1"><a class="header-anchor" href="#建立地理投影" aria-hidden="true">#</a> 建立地理投影</h3><p>這裡參照d3範例code去使用API，建立出來的path會在繪製圖形時使用。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> mapGraph <span class="token operator">=</span> svg<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&#39;g&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> projection <span class="token operator">=</span> d3
    <span class="token punctuation">.</span><span class="token function">geoEquirectangular</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">11000</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">center</span><span class="token punctuation">(</span>isPhoneSize <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token number">121</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">122</span><span class="token punctuation">,</span> <span class="token number">24.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>props<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> props<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> d3<span class="token punctuation">.</span><span class="token function">geoPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">projection</span><span class="token punctuation">(</span>projection<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="畫出topo-json圖形" tabindex="-1"><a class="header-anchor" href="#畫出topo-json圖形" aria-hidden="true">#</a> 畫出topo.json圖形</h3><p>這裡實際繪製的演算過程是倚賴套件處理。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//畫出行程區的深色區塊</span>
mapGraph
    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&#39;g&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#39;fill&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;#666&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#39;cursor&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;pointer&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>topojson<span class="token punctuation">.</span><span class="token function">feature</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> data<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token constant">COUNTY_MOI_1090820</span><span class="token punctuation">)</span><span class="token punctuation">.</span>features<span class="token punctuation">)</span> <span class="token comment">//綁定圖形數據</span>
    <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#39;id&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">d</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&#39;path-&#39;</span> <span class="token operator">+</span> d<span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token constant">COUNTYCODE</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> clicked<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#39;d&#39;</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//使用地底投影的路徑</span>

<span class="token comment">//畫出行程區的白線</span>
mapGraph
    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#39;fill&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#39;stroke&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;white&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#39;stroke-linejoin&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;round&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">&#39;d&#39;</span><span class="token punctuation">,</span> <span class="token function">path</span><span class="token punctuation">(</span>topojson<span class="token punctuation">.</span><span class="token function">mesh</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> data<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token constant">COUNTY_MOI_1090820</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">!==</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="綁定動作-click、zoom、reset-等" tabindex="-1"><a class="header-anchor" href="#綁定動作-click、zoom、reset-等" aria-hidden="true">#</a> 綁定動作(click、zoom、reset...等)</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//如 如行政區深色區塊綁訂的click</span>
d3<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&#39;#theSVG &gt; g &gt; g&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> clicked<span class="token punctuation">)</span>

<span class="token comment">// 最上層的svg</span>
svg<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> reset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">svg</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>zoom<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="效果" tabindex="-1"><a class="header-anchor" href="#效果" aria-hidden="true">#</a> 效果</h2>`,20),b={href:"https://lian0103.github.io/d3-map/",target:"_blank",rel:"noopener noreferrer"},f=n("img",{width:"250",src:"https://i.imgur.com/pWrmRZ2.gif"},null,-1),_=n("h2",{id:"連結",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#連結","aria-hidden":"true"},"#"),s(" 連結")],-1),j={href:"https://github.com/lian0103/d3-map",target:"_blank",rel:"noopener noreferrer"},x={href:"https://data.gov.tw/dataset/7441",target:"_blank",rel:"noopener noreferrer"},w={href:"https://observablehq.com/@d3/zoom-to-bounding-box",target:"_blank",rel:"noopener noreferrer"},z={href:"https://github.com/topojson/topojson-client",target:"_blank",rel:"noopener noreferrer"};function G(N,V){const t=e("router-link"),o=e("ExternalLinkIcon");return i(),l("div",null,[k,n("nav",d,[n("ul",null,[n("li",null,[a(t,{to:"#topo-json"},{default:p(()=>[s("topo.json")]),_:1})]),n("li",null,[a(t,{to:"#d3-topojson-client"},{default:p(()=>[s("d3 & topojson-client")]),_:1})]),n("li",null,[a(t,{to:"#實作重點"},{default:p(()=>[s("實作重點")]),_:1}),n("ul",null,[n("li",null,[a(t,{to:"#svg建立"},{default:p(()=>[s("svg建立")]),_:1})]),n("li",null,[a(t,{to:"#新增-g-層"},{default:p(()=>[s("新增'g'層")]),_:1})]),n("li",null,[a(t,{to:"#建立地理投影"},{default:p(()=>[s("建立地理投影")]),_:1})]),n("li",null,[a(t,{to:"#畫出topo-json圖形"},{default:p(()=>[s("畫出topo.json圖形")]),_:1})]),n("li",null,[a(t,{to:"#綁定動作-click、zoom、reset-等"},{default:p(()=>[s("綁定動作(click、zoom、reset...等)")]),_:1})])])]),n("li",null,[a(t,{to:"#效果"},{default:p(()=>[s("效果")]),_:1})]),n("li",null,[a(t,{to:"#連結"},{default:p(()=>[s("連結")]),_:1})])])]),v,h,n("p",null,[s("在台灣政府資料公開平台，可以下載到行政區的SHP格式檔案，再透過"),n("a",m,[s("線上工具"),a(o)]),s("topo.json格式。")]),g,n("p",null,[n("a",b,[s("demo"),a(o)])]),f,_,n("ul",null,[n("li",null,[n("a",j,[s("source code"),a(o)])]),n("li",null,[n("a",x,[s("台灣行政區圖資"),a(o)])]),n("li",null,[n("a",w,[s("D3js美國地圖zoom效果範例"),a(o)])]),n("li",null,[n("a",z,[s("topojson-client"),a(o)])])])])}const O=c(r,[["render",G],["__file","d3GeoMap.html.vue"]]);export{O as default};
