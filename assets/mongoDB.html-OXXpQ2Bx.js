import{_ as l,r as p,o as c,c as i,b as n,a,w as e,d as s,e as u}from"./app-ac5kRQ9F.js";const r={},d=n("h1",{id:"mongodb-本地與雲端",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#mongodb-本地與雲端","aria-hidden":"true"},"#"),s(" MongoDB 本地與雲端")],-1),k={class:"table-of-contents"},m=n("h2",{id:"環境安裝",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#環境安裝","aria-hidden":"true"},"#"),s(" 環境安裝")],-1),v=n("p",null,"在 windows 本機環境使用 MongoDB，先安裝下列三項:",-1),b={href:"https://www.mongodb.com/try/download/community",target:"_blank",rel:"noopener noreferrer"},g=n("img",{src:"https://i.imgur.com/mPIiEdF.png",alt:""},null,-1),h={href:"https://www.mongodb.com/try/download/compass",target:"_blank",rel:"noopener noreferrer"},f=n("img",{src:"https://i.imgur.com/W8607e1.png",alt:""},null,-1),_={href:"https://www.mongodb.com/try/download/shell",target:"_blank",rel:"noopener noreferrer"},y=u(`<div class="language-mongosh= line-numbers-mode" data-ext="mongosh="><pre class="language-mongosh="><code># 開啟mongoDB Shell
mongosh

# 顯示dbs
show dbs

# 切換db
use [db-name]

# db資料指令操作範例
db.itHome.find({author:&quot;ycchiuuuu&quot;}).sort({updateTime:-1})

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="匯入資料" tabindex="-1"><a class="header-anchor" href="#匯入資料" aria-hidden="true">#</a> 匯入資料</h2><p>以 2022ItHome 鐵人賽的資料來匯入，MongoDB Compass 可以直接匯入 JSON。點擊 ADD DATA，共匯入 4177 筆。 <img src="https://i.imgur.com/zh5v3la.png" alt=""></p><h2 id="mongodb-shell-操作" tabindex="-1"><a class="header-anchor" href="#mongodb-shell-操作" aria-hidden="true">#</a> MongoDB Shell 操作</h2><p>基本的查改新刪對應的方法，如 find()、update()、insert()、delete()，搭配可使用的$關鍵字，如 $in、$nin、$set、$pull、$push、$each、$regex。</p><div class="language-mongosh= line-numbers-mode" data-ext="mongosh="><pre class="language-mongosh="><code>db.itHome.find({ title: {$in: [&quot;源起、需求、技術堆疊&quot;]}})

db.itHome.find({_id:ObjectId(&quot;635a2477f12293f1417b1056&quot;)})

db.itHome.find({ title: {$regex:/vue|前端|vite/i}})

db.itHome.updateOne({_id:ObjectId(&quot;635a2477f12293f1417b1056&quot;)},{$set:{tag:[]}})

db.itHome.updateMany({},{$push:{tags:[&quot;2022&quot;]}})

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mongodb-driver" tabindex="-1"><a class="header-anchor" href="#mongodb-driver" aria-hidden="true">#</a> MongoDB Driver</h2><p>在應用中要去連接 MongoDB Server 需要使用 Driver，以 NodeJS 來說，必須先安裝。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> mongodb
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="使用-driver-連線" tabindex="-1"><a class="header-anchor" href="#使用-driver-連線" aria-hidden="true">#</a> 使用 Driver 連線</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//db.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> MongoClient <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mongodb&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 連線到本地的mongoDB server 的 articles (db)</span>
<span class="token keyword">const</span> <span class="token constant">URI</span> <span class="token operator">=</span> <span class="token string">&#39;mongodb://localhost:27017/articles&#39;</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">connectToDb</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    MongoClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&#39;mongodb://localhost:27017/articles&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">client</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        dbConnection <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">db</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">getDb</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> dbConnection<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="測試連線和查詢結果" tabindex="-1"><a class="header-anchor" href="#測試連線和查詢結果" aria-hidden="true">#</a> 測試連線和查詢結果</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 執行測試檔</span>
<span class="token function">node</span> ./ithome2022/dbTest.js
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//dbTest.js</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> connectToDb<span class="token punctuation">,</span> getDb <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./db&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">connectToDb</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">getDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> page <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> perPageLength <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> content <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  content <span class="token operator">=</span> <span class="token keyword">await</span> db
    <span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;itHome&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">$regex</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">vue|前端|vite</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">author</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token punctuation">(</span>page <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> perPageLength<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>perPageLength<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>測試另一種aggregate API</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> connectToDb<span class="token punctuation">,</span> getDb <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./db&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> agg <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">$match</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">$regex</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">vue|前端|vite</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">$sort</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">updateTime</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">connectToDb</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">getDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> cursor <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;itHome&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span>agg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> cursor<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mongodb-雲端版-altas" tabindex="-1"><a class="header-anchor" href="#mongodb-雲端版-altas" aria-hidden="true">#</a> MongoDB 雲端版 Altas</h2><p>雲端版可以讓應用的 MongoDB Driver 透過 URI 連線，也可以在本地端也支援 MongoDB Compass 來連線。</p><h3 id="altas-操作流程" tabindex="-1"><a class="header-anchor" href="#altas-操作流程" aria-hidden="true">#</a> Altas 操作流程</h3><ol><li><p>線上後台建立專案 <img src="https://i.imgur.com/m28c7nm.png" alt=""></p></li><li><p>建立串接服務 cluster 依照流程填寫 cluster 名稱、使用者帳密、開放的 IP 地址。在開發階段，要加入自己本機目前的 IP，才可以讓後續操作成功。</p></li></ol><ul><li><p>cluster 名稱(articles) <img src="https://i.imgur.com/JQyyXJw.png" alt=""></p></li><li><p>使用者帳密(tester/test1234) <img src="https://i.imgur.com/h1FizaD.png" alt=""></p></li><li><p>開放的 IP 地址(211.23.202.171/32) <img src="https://i.imgur.com/520o6TN.png" alt=""></p></li></ul><h3 id="匯入資料給-altas-cluster" tabindex="-1"><a class="header-anchor" href="#匯入資料給-altas-cluster" aria-hidden="true">#</a> 匯入資料給 Altas Cluster</h3><p>Altas 提供幾種連線方式，包含 MongoDB Shell、MongoDB Driver(如 nodeJS 使用範例可以在應用中使用)、MongoDB Compass..等。這裡目標仿照在本機使用 Compass，將鐵人賽文章匯入。</p><ul><li><p>取得 URI，把&lt;password&gt;替換成該使用的真實密碼(test1234) <img src="https://i.imgur.com/gCXJHGx.png" alt=""></p></li><li><p>建立新連線 <img src="https://i.imgur.com/shOLJoZ.png" alt=""></p></li><li><p>匯入資料結果 <img src="https://i.imgur.com/WzRreia.png" alt=""></p></li></ul><h2 id="連結" tabindex="-1"><a class="header-anchor" href="#連結" aria-hidden="true">#</a> 連結</h2>`,25),x={href:"https://github.com/lian0103/nodeServices/tree/main/ithome2022",target:"_blank",rel:"noopener noreferrer"},D={href:"https://www.mongodb.com/docs/manual/reference/operator/query/or/",target:"_blank",rel:"noopener noreferrer"},w={href:"https://blog.csdn.net/xiangwangxiangwang/article/details/88821513",target:"_blank",rel:"noopener noreferrer"},B={href:"https://github.com/iamshaunjp/complete-mongodb/blob/lesson-23/app.js",target:"_blank",rel:"noopener noreferrer"};function M(j,$){const t=p("router-link"),o=p("ExternalLinkIcon");return c(),i("div",null,[d,n("nav",k,[n("ul",null,[n("li",null,[a(t,{to:"#環境安裝"},{default:e(()=>[s("環境安裝")]),_:1})]),n("li",null,[a(t,{to:"#匯入資料"},{default:e(()=>[s("匯入資料")]),_:1})]),n("li",null,[a(t,{to:"#mongodb-shell-操作"},{default:e(()=>[s("MongoDB Shell 操作")]),_:1})]),n("li",null,[a(t,{to:"#mongodb-driver"},{default:e(()=>[s("MongoDB Driver")]),_:1}),n("ul",null,[n("li",null,[a(t,{to:"#使用-driver-連線"},{default:e(()=>[s("使用 Driver 連線")]),_:1})]),n("li",null,[a(t,{to:"#測試連線和查詢結果"},{default:e(()=>[s("測試連線和查詢結果")]),_:1})])])]),n("li",null,[a(t,{to:"#mongodb-雲端版-altas"},{default:e(()=>[s("MongoDB 雲端版 Altas")]),_:1}),n("ul",null,[n("li",null,[a(t,{to:"#altas-操作流程"},{default:e(()=>[s("Altas 操作流程")]),_:1})]),n("li",null,[a(t,{to:"#匯入資料給-altas-cluster"},{default:e(()=>[s("匯入資料給 Altas Cluster")]),_:1})])])]),n("li",null,[a(t,{to:"#連結"},{default:e(()=>[s("連結")]),_:1})])])]),m,v,n("ol",null,[n("li",null,[n("p",null,[n("a",b,[s("MongoDB Community Server"),a(o)]),s(" 成功安裝後，可以在工作管理員中查看服務的執行狀態。 "),g])]),n("li",null,[n("p",null,[n("a",h,[s("MongoDB Compass"),a(o)]),s(" 圖形化操作介面，開啟後的畫面。URI 是 Mongo 產生的連線路徑，而雲端版的 MongoDB Altas 也是使用 URI 去讓應用連線。 "),f])]),n("li",null,[n("p",null,[n("a",_,[s("MongoDB Shell"),a(o)]),s(" 安裝後可以在終端機使用 MongoDB 的指令做操作")])])]),y,n("p",null,[n("a",x,[s("代碼 nodeServices/ithome2022/"),a(o)])]),n("p",null,[n("a",D,[s("操作語法-$關鍵字"),a(o)])]),n("p",null,[n("a",w,[s("操作語法-正則"),a(o)])]),n("p",null,[n("a",B,[s("Ninja Express CRUD Sample"),a(o)])])])}const I=l(r,[["render",M],["__file","mongoDB.html.vue"]]);export{I as default};
